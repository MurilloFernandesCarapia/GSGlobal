package br.com.fiap.main;

import br.com.fiap.bean.Polo;
import br.com.fiap.bean.ClimaPolarService;
import br.com.fiap.bean.SensorHidrico;

import javax.swing.JOptionPane;
import java.io.IOException;

public class Main {

    private static ClimaPolarService climaService = new ClimaPolarService();
    private static SensorHidrico sensorHidrico = new SensorHidrico();

    private static final double GLOBAL_TEMP_ALERT_THRESHOLD = 2.0;

    public static void main(String[] args) {
        Polo poloNorte = new Polo("Polo Norte", 89.9, 0.0);
        Polo poloSul = new Polo("Polo Sul", -89.9, 0.0);

        String menu = "üåç Plataforma de Monitoramento de Degelo Polar üßä\n\n" +
                "Escolha uma op√ß√£o:\n\n" +
                "1. üå°Ô∏è Ver Temperatura do Polo Norte\n" +
                "2. üå°Ô∏è Ver Temperatura do Polo Sul\n" +
                "3. üíß Ver N√≠vel da √Ågua no Polo Norte\n" +
                "4. üíß Ver N√≠vel da √Ågua no Polo Sul\n" +
                "5. üìã Gerar Relat√≥rio Completo de Alertas\n" +
                "6. üë• Ver Integrantes do Grupo\n" +
                "7. üí° Nossa Solu√ß√£o\n" +
                "8. ‚ùå Sair da Plataforma\n";

        int opcao = 0;
        do {
            try {
                String input = JOptionPane.showInputDialog(null, menu, "Monitoramento Polar - Grupo Eco Ambiental üåé", JOptionPane.INFORMATION_MESSAGE);
                if (input == null) {
                    opcao = 8;
                    continue;
                }
                opcao = Integer.parseInt(input);

                switch (opcao) {
                    case 1:
                        verTemperaturaPolo(poloNorte);
                        break;
                    case 2:
                        verTemperaturaPolo(poloSul);
                        break;
                    case 3:
                        verNivelAgua(poloNorte);
                        break;
                    case 4:
                        verNivelAgua(poloSul);
                        break;
                    case 5:
                        gerarRelatorioCompleto(poloNorte, poloSul);
                        break;
                    case 6:
                        String integrantes = "üë• Integrantes:\n" +
                                "- Murillo Fernandes Carapia, RM: 564969, Turma: 1TDSPH (Matutino)\n" +
                                "- Leonardo Zerbinatti de Sales, RM: 562992, Turma: 1TDSPH (Matutino)\n" +
                                "- Breno da Fonseca Eleut√©rio, RM: 564948, Turma: 1TDSPY (Noturno)";
                        JOptionPane.showMessageDialog(null, integrantes, "Nosso Grupo", JOptionPane.INFORMATION_MESSAGE);
                        break;
                    case 7:
                        JOptionPane.showMessageDialog(null, "üí° Nossa Solu√ß√£o: \n\n" +
                                        "Atualmente, o derretimento de gelo nos polos terrestres √© um dos eventos extremos que mais geram problemas para a humanidade. " +
                                        "Portanto, esses eventos ocorrem devido ao aquecimento global, de maneira agressiva e prejudicial ao ambiente onde vivemos. " +
                                        "Isso resulta no aquecimento da terra e no deslizamento de grandes blocos de gelo para o oceano, o que pode elevar o n√≠vel da √°gua e provocar grandes danos. " +
                                        "Tais eventos podem causar impactos ambientais e globais, incluindo tsunamis, altera√ß√µes clim√°ticas, eleva√ß√£o do n√≠vel da √°gua devido ao derretimento, " +
                                        "resultando em inunda√ß√µes em cidades litor√¢neas, e no aumento da velocidade das correntes mar√≠timas, al√©m de intensificar a frequ√™ncia e a intensidade de eventos clim√°ticos extremos.\n\n" +
                                        "‚ùÑÔ∏è Plataforma de Monitoramento e Preven√ß√£o de Degelo Polar com Dados Clim√°ticos em Tempo Real\n" +
                                        "Nosso objetivo √© monitorar o degelo nas regi√µes polares e em cidades costeiras para medir o n√≠vel da √°gua em tempo real usando sensores, " +
                                        "e fornecer alertas e a√ß√µes sugeridas para empresas globais, a fim de diminuir o aquecimento global e conscientizar os problemas causados pelo derretimento. " +
                                        "Assim, informando as provid√™ncias necess√°rias para diminuir o aquecimento global, consequentemente diminuir os deslizamentos e derretimentos de gelo.\n",
                                "Nossa Solu√ß√£o", JOptionPane.INFORMATION_MESSAGE);
                        break;
                    case 8:
                        JOptionPane.showMessageDialog(null, "Saindo da plataforma. At√© logo! üëã", "At√© mais!", JOptionPane.INFORMATION_MESSAGE);
                        break;
                    default:
                        JOptionPane.showMessageDialog(null, "Op√ß√£o inv√°lida. Por favor, escolha um n√∫mero de 1 a 8.", "Erro de Op√ß√£o", JOptionPane.ERROR_MESSAGE);
                }
            } catch (NumberFormatException e) {
                JOptionPane.showMessageDialog(null, "Entrada inv√°lida. Por favor, digite um n√∫mero inteiro.", "Erro de Entrada", JOptionPane.ERROR_MESSAGE);
            } catch (IOException | InterruptedException e) {
                JOptionPane.showMessageDialog(null, "Erro de conex√£o ou leitura da API: " + e.getMessage(), "Erro de Servi√ßo", JOptionPane.ERROR_MESSAGE);
                e.printStackTrace();
            } catch (Exception e) {
                JOptionPane.showMessageDialog(null, "Ocorreu um erro inesperado: " + e.getMessage(), "Erro Inesperado", JOptionPane.ERROR_MESSAGE);
                e.printStackTrace();
            }
        } while (opcao != 8);
        if (JOptionPane.showConfirmDialog(null, "Deseja usar o Programa da Eco Ambiental novamente?", "Aten√ß√£o", JOptionPane.YES_NO_OPTION, JOptionPane.QUESTION_MESSAGE) == 0) {
            main(args);
        } else {
            JOptionPane.showMessageDialog(null, "Fim de Programa. Volte Sempre!", "Adeus", JOptionPane.WARNING_MESSAGE);
        }
    }

    private static void verTemperaturaPolo(Polo polo) throws IOException, InterruptedException {
        Double temperatura = climaService.getTemperaturaAtual(polo);
        if (temperatura != null) {
            JOptionPane.showMessageDialog(null, "üå°Ô∏è Temperatura atual no " + polo.getNome() + ": " +
                    String.format("%.2f", temperatura) + " ¬∞C", "Temperatura Atual", JOptionPane.INFORMATION_MESSAGE);

            if (temperatura > GLOBAL_TEMP_ALERT_THRESHOLD) {
                exibirAlertaGlobalTemperatura(polo, temperatura);
            }
        } else {
            JOptionPane.showMessageDialog(null, "N√£o foi poss√≠vel obter a temperatura para o " + polo.getNome() + ".", "Erro de Temperatura", JOptionPane.WARNING_MESSAGE);
        }
    }

    private static void verNivelAgua(Polo polo) throws IOException, InterruptedException {
        double nivelAgua = sensorHidrico.obterNivelAgua(polo);
        if (nivelAgua >= 0) {
            JOptionPane.showMessageDialog(null, "üíß N√≠vel da √°gua no " + polo.getNome() + ": " + String.format("%.2f", nivelAgua) + " metros", "N√≠vel da √Ågua", JOptionPane.INFORMATION_MESSAGE);

            if (sensorHidrico.verificarAlertaNivelAlto(polo)) {
                exibirAlertaGlobalNivelAgua(polo, nivelAgua);
            }
        } else {
            JOptionPane.showMessageDialog(null, "N√£o foi poss√≠vel obter o n√≠vel da √°gua no " + polo.getNome() + ".", "Erro de N√≠vel da √Ågua", JOptionPane.WARNING_MESSAGE);
        }
    }

    private static void gerarRelatorioCompleto(Polo poloNorte, Polo poloSul) throws IOException, InterruptedException {
        StringBuilder relatorio = new StringBuilder();
        relatorio.append("üìã Relat√≥rio Completo de Alertas de Degelo ‚ö†Ô∏è\n\n");

        boolean alertaGlobalAcionado = false;

        Double tempNorte = climaService.getTemperaturaAtual(poloNorte);
        double nivelNorte = sensorHidrico.obterNivelAgua(poloNorte);
        boolean alertaTempNorte = (tempNorte != null && climaService.verificarAlertaDegelo(poloNorte, 0.0));
        boolean alertaNivelNorte = sensorHidrico.verificarAlertaNivelAlto(poloNorte);

        relatorio.append("‚ùÑÔ∏è ").append(poloNorte.getNome()).append(":\n");
        relatorio.append("  Temperatura: ").append(tempNorte != null ? String.format("%.2f", tempNorte) + " ¬∞C" : "N/A").append("\n");
        relatorio.append("  N√≠vel da √Ågua: ").append(nivelNorte >= 0 ? String.format("%.2f", nivelNorte) + " metros" : "N/A").append("\n");

        if (alertaTempNorte) {
            relatorio.append("  ‚ö†Ô∏è ALERTA DE TEMPERATURA: Acima de 0¬∞C!\n");
            alertaGlobalAcionado = true;
        } else {
            relatorio.append("  ‚úÖ Temperatura: OK.\n");
        }
        if (alertaNivelNorte) {
            relatorio.append("  ‚ö†Ô∏è ALERTA DE N√çVEL DA √ÅGUA: Acima do limite cr√≠tico!\n");
            alertaGlobalAcionado = true;
        } else {
            relatorio.append("  ‚úÖ N√≠vel da √Ågua: OK.\n");
        }
        relatorio.append("\n");

        Double tempSul = climaService.getTemperaturaAtual(poloSul);
        double nivelSul = sensorHidrico.obterNivelAgua(poloSul);
        boolean alertaTempSul = (tempSul != null && climaService.verificarAlertaDegelo(poloSul));
        boolean alertaNivelSul = sensorHidrico.verificarAlertaNivelAlto(poloSul);

        relatorio.append("üêß ").append(poloSul.getNome()).append(":\n");
        relatorio.append("  Temperatura: ").append(tempSul != null ? String.format("%.2f", tempSul) + " ¬∞C" : "N/A").append("\n");
        relatorio.append("  N√≠vel da √Ågua: ").append(nivelSul >= 0 ? String.format("%.2f", nivelSul) + " metros" : "N/A").append("\n");

        if (alertaTempSul) {
            relatorio.append("  ‚ö†Ô∏è ALERTA DE TEMPERATURA: Acima do limiar cr√≠tico!\n");
            alertaGlobalAcionado = true;
        } else {
            relatorio.append("  ‚úÖ Temperatura: OK.\n");
        }
        if (alertaNivelSul) {
            relatorio.append("  ‚ö†Ô∏è ALERTA DE N√çVEL DA √ÅGUA: Acima do limite cr√≠tico!\n");
            alertaGlobalAcionado = true;
        } else {
            relatorio.append("  ‚úÖ N√≠vel da √Ågua: OK.\n");
        }
        relatorio.append("\n");

        if (!alertaGlobalAcionado) {
            relatorio.append("üëç Nenhum alerta cr√≠tico de degelo acionado para os polos no momento. Continue monitorando!\n");
        } else {
            relatorio.append("---\n");
            relatorio.append("üö® ALERTA GLOBAL: A√ß√£o Urgente Necess√°ria! üö®\n");
            relatorio.append("As condi√ß√µes atuais indicam um risco elevado de degelo e eleva√ß√£o do n√≠vel do mar. √â crucial que grandes empresas e ind√∫strias intensifiquem seus esfor√ßos para combater as mudan√ßas clim√°ticas.\n\n");
            relatorio.append("Recomenda√ß√µes para Grandes Empresas:\n");
            relatorio.append(" - üìâ Reduzam o uso de combust√≠veis f√≥sseis (carv√£o, petr√≥leo, g√°s) e invistam em energia limpa.\n");
            relatorio.append(" - üí° Usem energia de forma mais eficiente em suas f√°bricas e escrit√≥rios.\n");
            relatorio.append(" - ‚ôªÔ∏è Reutilizem e reciclem mais materiais, produzindo menos lixo.\n");
            relatorio.append(" - üå≥ Plantem √°rvores e protejam florestas para ajudar a absorver CO2.\n");
            relatorio.append(" - üíß Gerenciem a √°gua de forma inteligente para evitar desperd√≠cio e polui√ß√£o.\n");
            relatorio.append(" - üó£Ô∏è Conversem com seus fornecedores e clientes sobre a import√¢ncia de serem mais sustent√°veis.\n\n");
            relatorio.append("O futuro do planeta depende das decis√µes tomadas hoje. Seja parte da solu√ß√£o!\n");
        }

        JOptionPane.showMessageDialog(null, relatorio.toString(), "Relat√≥rio de Monitoramento Polar", JOptionPane.INFORMATION_MESSAGE);
    }

    private static void exibirAlertaGlobalTemperatura(Polo polo, Double temperatura) {
        StringBuilder alertaMensagem = new StringBuilder();
        alertaMensagem.append("üö® ALERTA DE TEMPERATURA CR√çTICA NO ").append(polo.getNome().toUpperCase()).append("! üö®\n\n");
        alertaMensagem.append("Temperatura atual: ").append(String.format("%.2f", temperatura)).append(" ¬∞C\n");
        alertaMensagem.append("O valor est√° acima do limiar cr√≠tico de ").append(GLOBAL_TEMP_ALERT_THRESHOLD).append("¬∞C, indicando acelera√ß√£o do degelo.\n\n");
        alertaMensagem.append("--- Mensagem Urgente para Grandes Empresas e Ind√∫strias ---\n");
        alertaMensagem.append("A eleva√ß√£o da temperatura polar exige a√ß√£o imediata. Contribuam para a redu√ß√£o do aquecimento global atrav√©s de:\n");
        alertaMensagem.append(" - üìâ Reduzam o uso de combust√≠veis f√≥sseis (carv√£o, petr√≥leo, g√°s) e invistam em energia limpa.\n");
        alertaMensagem.append(" - üí° Usem energia de forma mais eficiente em suas f√°bricas e escrit√≥rios.\n");
        alertaMensagem.append(" - ‚ôªÔ∏è Reutilizem e reciclem mais materiais, produzindo menos lixo.\n");
        alertaMensagem.append(" - üå≥ Plantem √°rvores e protejam florestas para ajudar a absorver CO2.\n");
        alertaMensagem.append(" - üíß Gerenciem a √°gua de forma inteligente para evitar desperd√≠cio e polui√ß√£o.\n");
        alertaMensagem.append(" - üó£Ô∏è Conversem com seus fornecedores e clientes sobre a import√¢ncia de serem mais sustent√°veis.\n\n");
        alertaMensagem.append("Sejam a mudan√ßa que o planeta precisa!\n");

        JOptionPane.showMessageDialog(null, alertaMensagem.toString(), "Alerta Cr√≠tico de Temperatura!", JOptionPane.ERROR_MESSAGE);
    }

    private static void exibirAlertaGlobalNivelAgua(Polo polo, double nivelAgua) {
        StringBuilder alertaMensagem = new StringBuilder();
        alertaMensagem.append("üö® ALERTA DE N√çVEL DE √ÅGUA CR√çTICO NO ").append(polo.getNome().toUpperCase()).append("! üö®\n\n");
        alertaMensagem.append("N√≠vel da √°gua: ").append(String.format("%.2f", nivelAgua)).append(" metros\n");
        alertaMensagem.append("O valor est√° acima do limite cr√≠tico, indicando eleva√ß√£o do n√≠vel do mar devido ao degelo.\n\n");
        alertaMensagem.append("--- Mensagem Urgente para Grandes Empresas e Ind√∫strias ---\n");
        alertaMensagem.append("A eleva√ß√£o do n√≠vel da √°gua polar exige a√ß√£o imediata. Contribuam para a redu√ß√£o do aquecimento global atrav√©s de:\n");
        alertaMensagem.append(" - üìâ Reduzam o uso de combust√≠veis f√≥sseis (carv√£o, petr√≥leo, g√°s) e invistam em energia limpa.\n");
        alertaMensagem.append(" - üí° Usem energia de forma mais eficiente em suas f√°bricas e escrit√≥rios.\n");
        alertaMensagem.append(" - ‚ôªÔ∏è Reutilizem e reciclem mais materiais, produzindo menos lixo.\n");
        alertaMensagem.append(" - üå≥ Plantem √°rvores e protejam florestas para ajudar a absorver CO2.\n");
        alertaMensagem.append(" - üíß Gerenciem a √°gua de forma inteligente para evitar desperd√≠cio e polui√ß√£o.\n");
        alertaMensagem.append(" - üó£Ô∏è Conversem com seus fornecedores e clientes sobre a import√¢ncia de serem mais sustent√°veis.\n\n");
        alertaMensagem.append("Sejam a mudan√ßa que o planeta precisa!\n");

        JOptionPane.showMessageDialog(null, alertaMensagem.toString(), "Alerta Cr√≠tico de N√≠vel da √Ågua!", JOptionPane.ERROR_MESSAGE);
    }
}